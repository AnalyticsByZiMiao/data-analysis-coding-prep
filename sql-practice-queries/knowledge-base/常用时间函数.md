# MySQL 时间函数指南

> 本文档整理 MySQL 中高频使用的时间处理函数，适用于数据清洗、报表开发、趋势分析等场景。

---

## 一、获取当前时间

| 函数 | 返回类型 | 说明 | 示例 |
|------|----------|------|------|
| `CURDATE()` | `DATE` | 当前日期 | `SELECT CURDATE(); → 2024-07-29` |
| `CURTIME()` | `TIME` | 当前时间 | `SELECT CURTIME(); → 14:30:00` |
| `NOW()` | `DATETIME` | 当前日期+时间 | `SELECT NOW(); → 2024-07-29 14:30:00` |
| `UNIX_TIMESTAMP()` | `INT` | 当前 Unix 时间戳 | `SELECT UNIX_TIMESTAMP(); → 1722241800` |

---

## 二、时间计算与偏移

### 1. 时间加减
以下是 MySQL 常用时间函数的整理笔记，已按 ​​核心功能分类​​ 并附详细说明和示例，可直接复制到你的数据分析仓库中：

📌 ​​MySQL 时间函数速查表​​
​​文件位置建议​​：

你的仓库/技术栈/SQL/MySQL时间函数.md

或

你的仓库/数据分析知识库/数据清洗与转换/时间处理.md

# MySQL 时间函数指南

> 本文档整理 MySQL 中高频使用的时间处理函数，适用于数据清洗、报表开发、趋势分析等场景。

---

## 一、获取当前时间

| 函数 | 返回类型 | 说明 | 示例 |
|------|----------|------|------|
| `CURDATE()` | `DATE` | 当前日期 | `SELECT CURDATE(); → 2024-07-29` |
| `CURTIME()` | `TIME` | 当前时间 | `SELECT CURTIME(); → 14:30:00` |
| `NOW()` | `DATETIME` | 当前日期+时间 | `SELECT NOW(); → 2024-07-29 14:30:00` |
| `UNIX_TIMESTAMP()` | `INT` | 当前 Unix 时间戳 | `SELECT UNIX_TIMESTAMP(); → 1722241800` |

---

## 二、时间计算与偏移

### 1. 时间加减
```sql

-- 增加 7 天

SELECT DATE_ADD('2024-07-29', INTERVAL 7 DAY); → 2024-08-05

-- 减少 3 个月

SELECT DATE_SUB('2024-07-29', INTERVAL 3 MONTH); → 2024-04-29
```

### 2. 时间差计算
```sql

-- 计算相差天数

SELECT DATEDIFF('2024-08-01', '2024-07-29'); → 3

-- 计算相差秒数（支持跨年）

SELECT TIMESTAMPDIFF(SECOND, '2024-07-29 00:00:00', '2024-07-30 01:00:00'); → 90000
```
### 3. 月末/周初处理
```sql

-- 获取当月最后一天

SELECT LAST_DAY('2024-07-15'); → 2024-07-31

-- 获取下周一的日期

SELECT DATE_ADD(CURDATE(), INTERVAL (9 - DAYOFWEEK(CURDATE())) DAY);
```
---

## 三、时间部分提取

| 函数 | 说明 | 示例 |
|------|------|------|
| `YEAR(date)` | 提取年份 | `SELECT YEAR('2024-07-29'); → 2024` |
| `MONTH(date)` | 提取月份 (1-12) | `SELECT MONTH('2024-07-29'); → 7` |
| `DAY(date)` | 提取日 (1-31) | `SELECT DAY('2024-07-29'); → 29` |
| `HOUR(time)` | 提取小时 | `SELECT HOUR('14:30:00'); → 14` |
| `MINUTE(time)` | 提取分钟 | `SELECT MINUTE('14:30:00'); → 30` |
| `DAYOFWEEK(date)` | 星期几 (1=周日, 7=周六) | `SELECT DAYOFWEEK('2024-07-29'); → 2（周一）` |
| `QUARTER(date)` | 季度 (1-4) | `SELECT QUARTER('2024-07-29'); → 3` |

---

## 四、时间格式化与转换

### 1. 时间 → 字符串
```sql

SELECT DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i:%s'); → '2024-07-29 14:30:00'

SELECT DATE_FORMAT(NOW(), '%Y年%m月%d日'); → '2024年07月29日'
```
### 2. 字符串 → 时间
```sql

SELECT STR_TO_DATE('2024-07-29', '%Y-%m-%d'); → 2024-07-29（DATE类型）

SELECT STR_TO_DATE('14:30:00', '%H:%i:%s'); → 14:30:00（TIME类型）
```
### 3. Unix 时间戳转换
```sql

-- 时间戳 → 时间

SELECT FROM_UNIXTIME(1722241800); → 2024-07-29 14:30:00

-- 时间 → 时间戳

SELECT UNIX_TIMESTAMP('2024-07-29 14:30:00'); → 1722241800
```
---

## 五、高频实战场景

### 场景 1：按周聚合数据
```sql

SELECT

DATE_FORMAT(order_date, '%Y-%U') AS week,

SUM(amount) AS total_sales

FROM orders

GROUP BY week;
```
### 场景 2：计算用户留存率
```sql

SELECT

DATEDIFF(activation_date, signup_date) AS day_diff,

COUNT(DISTINCT user_id) AS retained_users

FROM user_activity

GROUP BY day_diff;
```

### 场景 3：生成时间序列
```sql

SELECT DATE_ADD('2024-07-01', INTERVAL t.seq DAY) AS date_seq

FROM (

SELECT 0 AS seq UNION SELECT 1 UNION SELECT 2 ... UNION SELECT 30

) t;
```
---

## ⚠️ 注意事项
1. **时区问题**：  
   使用 `SET time_zone = '+8:00';` 统一时区
2. **索引失效**：  
   避免在 WHERE 中对字段使用函数（如 `WHERE YEAR(create_time)=2024`），改用范围查询
3. **性能优化**：  
   复杂时间计算尽量在应用层处理，减轻数据库压力